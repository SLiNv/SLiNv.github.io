---
layout: post
title: "Ruby on Rails Arbitrary File Content Disclosure Lab (CVE-2019-5418)"
excerpt: "There is a File Content Disclosure vulnerability in Action View (Rails) <5.2.2.1, <5.1.6.2, <5.0.7.2, <4.2.11.1 where specially crafted accept headers can cause contents of arbitrary files on the target system's filesystem to be exposed."
categories: [pentesting-lab]
comments: true
image:
  feature: ruby-on-rails-cve-2019-5418/ruby-on-rails-logo.png
  show: true
tag: ['cybersecurity', 'pentesting', 'infosec', 'ruby on rails', 'vul-lab', 'web app security']
---

Rails is a web application development framework written in the Ruby programming language. It is designed to make programming web applications easier by making assumptions about what every developer needs to get started.

[CVE-2019-5418] description: [NVD]()

> There is a File Content Disclosure vulnerability in Action View (Rails) <5.2.2.1, <5.1.6.2, <5.0.7.2, <4.2.11.1 where specially crafted accept headers can cause contents of arbitrary files on the target system's filesystem to be exposed.
> Versions Affected:  All. 
> Not affected:       None. 
> Fixed Versions:     6.0.0.beta3, 5.2.2.1, 5.1.6.2, 5.0.7.2, 4.2.11.1 
> The impact is limited to calls to render which render file contents without a specified accept format.  Impacted code in a controller looks something like this: 
> class UserController < ApplicationController 
> def index 
>    render file: "#{Rails.root}/some/file" 
> end 
> end

## Simulation

Lab Environment:
```
CentOS 7:
  Ruby 2.3.3
  Rails 5.2.1
```

#### Set Up Ruby on Rails Environment:

We will use ![rbenv][1] to manage development environments.

1. Install git if your don't already have it.

2. Clone rbenv into ~/.rbenv.
```
$ git clone https://github.com/rbenv/rbenv.git ~/.rbenv
```

3. (Optional) Install the ```rbenv``` plugin to build ruby 
```
git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
```

4. (Optional) Install gemset management for rbenv
```
git clone git://github.com/jamis/rbenv-gemset.git ~/.rbenv/plugins/rbenv-gemset
```

5. (Optional) Install rbenv-gem-rehash so that you never need to run ```rbenv rehash``` again
```
git clone git://github.com/sstephenson/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash
```

6. I want to use ```rbenv update``` to update rbenv and all plugins, so install rbenv-update
```
git clone git://github.com/rkh/rbenv-update.git ~/.rbenv/plugins/rbenv-update
```

7. Add ~/.rbenv/bin to your $PATH for access to the rbenv command-line utility
```
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
```

8. Use ```source ~/.bashrc``` or restart your shell so that PATH changes take effect. (Opening a new terminal tab will usually do it.)

9. Now let's install Ruby
```
rbenv install --list    # list all Ruby versions
rbenv install 2.3.3     # we use 2.3.3 here
```

10. Set rbenv's Rubny version to 2.3.3
```
rbenv global 2.3.3
ruby -v              # check ruby version
```




[1]: https://github.com/rbenv/rbenv
